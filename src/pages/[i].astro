---
import { fade, slide } from "astro:transitions";
const pages = [
    { i: 1, src: "/src/assets/-01.webp" },
    { i: 2, src: "/src/assets/-02.webp" },
    { i: 3, src: "/src/assets/-03.webp" },
    { i: 4, src: "/src/assets/-04.webp" },
    { i: 5, src: "/src/assets/-05.webp" },
    { i: 6, src: "/src/assets/-06.webp" },
    { i: 7, src: "/src/assets/-07.webp" },
    { i: 8, src: "/src/assets/-08.webp" },
    { i: 9, src: "/src/assets/-09.webp" },
    { i: 10, src: "/src/assets/-10.webp" },
    { i: 11, src: "/src/assets/-11.webp" },
    { i: 12, src: "/src/assets/-12.webp" },
    { i: 13, src: "/src/assets/-13.webp" },
    { i: 14, src: "/src/assets/-14.webp" },
    { i: 15, src: "/src/assets/-15.webp" },
    { i: 16, src: "/src/assets/-16.webp" },
    { i: 17, src: "/src/assets/-17.webp" },
    { i: 18, src: "/src/assets/-18.webp" },
    { i: 19, src: "/src/assets/-19.webp" },
    { i: 20, src: "/src/assets/-20.webp" },
    { i: 21, src: "/src/assets/-21.webp" },
    { i: 22, src: "/src/assets/-22.webp" },
    { i: 23, src: "/src/assets/-23.webp" },
    { i: 24, src: "/src/assets/-24.webp" },
    { i: 25, src: "/src/assets/-25.webp" },
    { i: 26, src: "/src/assets/-26.webp" },
    { i: 27, src: "/src/assets/-27.webp" },
    { i: 28, src: "/src/assets/-28.webp" },
    { i: 29, src: "/src/assets/-29.webp" },
    { i: 30, src: "/src/assets/-30.webp" },
    { i: 31, src: "/src/assets/-31.webp" },
    { i: 32, src: "/src/assets/-32.webp" },
    { i: 33, src: "/src/assets/-33.webp" },
];
import type { ImageMetadata } from "astro";
import Layout from "../layouts/Layout.astro";
const anim = {
    old: {
        name: "fadeIn",
        duration: "0.8s",
        easing: "linear",
        fillMode: "forwards",
    },
    new: {
        name: "fadeOut",
        duration: "1s",
        easing: "linear",
        fillMode: "forwards",
        delay: "0.8s", // This delay should match the duration of the fade-in animation
    },
};

const myFade = {
    forwards: anim,
    backwards: anim,
};

const images = import.meta.glob<{ default: ImageMetadata }>("/src/assets/*");
const { i } = Astro.params;
if (!i) return Astro.redirect("/404");
let index = Number(i);
if (index < 0) return Astro.redirect("/" + (pages.length - 1).toString());
if (index >= pages.length) return Astro.redirect("/1");
const test = pages.find((p) => p.i === index);
/* const test2 = pages.find((p) => p.i === index + 1); */
if (!test /* || !test2 */) return Astro.redirect("/404");

if (!images[test.src])
    throw new Error(
        `"${test.src}" does not exist in glob: "src/assets/*.{webp}"`,
    );
/* if (!images[test2.src])
    throw new Error(
        `"${test2.src}" does not exist in glob: "src/assets/*.{webp}"`,
    ); */
const img1 = await images[test.src]();
/* const img2 = await images[test2.src](); */
---

<Layout title="MAGAZINE">
    <main class="container">
        <button class="nav-button left">-</button>
        <img
            transition:animate={fade({ duration: "0.3s" })}
            id="img"
            class="full-screen-image"
            src={img1.default.src}
            alt="test failed"
            style="visibility: hidden;"
        />
        <button class="nav-button right">+</button>
    </main>
    <script>
        import { navigate } from "astro:transitions/client";

        document.addEventListener("astro:page-load", () => {
            document
                .querySelector(".left")
                .addEventListener("click", () => changePage(false));
            document
                .querySelector(".right")
                .addEventListener("click", () => changePage(true));

            function changePage(dir: boolean) {
                if (!dir)
                    navigate(
                        (
                            Number(window.location.pathname.slice(1)) - 1
                        ).toString(),
                    );
                else
                    navigate(
                        (
                            Number(window.location.pathname.slice(1)) + 1
                        ).toString(),
                    );
            }
          /*   window.addEventListener("popstate", function (event) {
                // Handle the state change here
                console.log("Location changed!", location.href);

                
                // Your script logic here, which will run every time navigate() is called
            }); */
            const img = document.getElementById("img");

                const observer = new IntersectionObserver(
                    (entries) => {
                        entries.forEach((entry) => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add("fadeIn");
                            }
                        });
                    },
                    { threshold: 0.1 },
                );

                observer.observe(img);

                function checkImageComplete() {
                    img.style.visibility = "visible";
                }
                img.addEventListener("onload", checkImageComplete);
        });
    </script>
</Layout>
<style>
    .left {
        left: 0;
        z-index: 100;
    }
    .right {
        right: 0;
        z-index: 100;
    }
    .nav-button {
        position: absolute;
        height: 100%;
        width: 30px;
        background-color: white;
        cursor: pointer;
    }

    .container {
        display: flex;
        width: 100%;
    }

    .full-screen-image {
        width: 100%;
        height: 100vh; /* Full height of the viewport */
        object-fit: contain;
        padding-left: 30px;
        padding-right: 30px;
    }

    .image-to-fade {
        visibility: hidden;
    }
    @keyframes fadeIn {
        0% {
            opacity: 0;
        }
        20% {
            opacity: 0.2;
        }
        30% {
            opacity: 0.3;
        }
        40% {
            opacity: 0.4;
        }
        50% {
            opacity: 0.5;
        }
        60% {
            opacity: 0.6;
        }
        70% {
            opacity: 0.7;
        }
        80% {
            opacity: 0.8;
        }
        90% {
            opacity: 0.9;
        }

        100% {
            opacity: 1;
        }
    }
    .fadeIn {
        animation: fadeIn 0.3s forwards linear; /* Adjust duration as needed */
        visibility: visible !important;
    }
</style>
